#!/bin/sh
#
# This script is run only once by chezmoi to install the foundational
# system packages and the mise tool manager. It prepares the bare
# operating system for user-level development tooling.

set -e # Exit immediately if a command exits with a non-zero status.







# --- macOS ---
{{ if eq .chezmoi.os "darwin" -}}
echo "â€ºâ€ºâ€º ðŸŽ Running macOS setup..."
# Check for Homebrew and install it if not found
if ! command -v brew >/dev/null 2>&1; then
  echo "  Installing Homebrew..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"


fi

echo "  Updating Homebrew and installing packages from Brewfile..."
# Assumes you have a `Brewfile` managed by chezmoi in your root
brew bundle --global

# --- Debian/Ubuntu ---
{{ else if eq .chezmoi.os "linux" -}}
  {{ if .chezmoi.osRelease.id | lower | eq "ubuntu" "debian" -}}
echo "â€ºâ€ºâ€º ðŸ§ Running Debian/Ubuntu setup..."
sudo apt-get update
sudo apt-get install -y \
  build-essential \
  pkg-config \
  libssl-dev \
  curl \
  wget \
  git \
  unzip \
  jq \
  zsh \
  fish \
  tmux

  # --- Fedora ---
  {{ else if .chezmoi.osRelease.id | lower | eq "fedora" -}}
echo "â€ºâ€ºâ€º ðŸ§ Running Fedora setup..."
sudo dnf install -y \
  @development-tools \
  libssl-devel \
  curl \
  wget \
  git \
  unzip \
  jq \
  zsh \
  fish \
  tmux

  # --- Arch Linux ---
  {{ else if .chezmoi.osRelease.id | lower | eq "arch" -}}
echo "â€ºâ€ºâ€º ðŸ§ Running Arch Linux setup..."
sudo pacman -Syu --noconfirm
sudo pacman -S --noconfirm \
  base-devel \
  openssl \
  curl \
  wget \
  git \
  unzip \
  jq \
  zsh \
  fish \
  tmux
  {{ end -}}
{{ end -}}

# --- Install Mise ---
if ! command -v mise >/dev/null 2>&1; then
  echo "â€ºâ€ºâ€º Installing mise..."
  curl https://mise.run | sh
fi

echo "âœ… Bootstrap complete. Foundational packages and mise are installed. Restart your terminal"
